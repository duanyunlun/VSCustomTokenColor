2026-01-30 22:07:42

## 变更摘要
- 同步“文档/实现不一致”：以当前实现为准更新 `README.md` 与工作计划文档，避免误导。
- 新增 `docs/Readme.md`，说明 docs 目录用途与更新时机。
- 引入“每次修改必须写进度并 push”的协作约定（见仓库根目录 `AGENTS.md`）。

## 变更原因
- 原 README 与实现存在差异（例如：预览文档写入方式、按钮数量、语言列表策略等），在不同机器/会话中易造成误操作。
- 需要一个可持续同步的进度文档，确保异地机器上的 AI 对话能快速对齐上下文与当前状态。

## 验证方式
1) 安装依赖：`npm ci`
2) 编译：`npm run compile`

## 备注/后续
- 后续每次提交都要在本文件追加记录，并 push 到远端。

---

2026-01-30 22:57:52

## 变更摘要
- 新增“高级：自定义 selector”能力：支持 TextMate scopes（写入 `editor.tokenColorCustomizations` 的主题块 textMateRules），用于处理 Inspect 面板里只有 textmate scopes、没有语义 token 的场景（例如 C/C++ 的 `entity.name.function.definition.cpp`）。
- 扩展 Preset 存储结构：增加 `textMateRules`，并在预览/应用时与语义规则一起写入 settings；同样支持会话快照与未保存自动回滚。

## 变更原因
- 仅靠 `editor.semanticTokenColorCustomizations` 无法覆盖“只由 TextMate scopes 产生的高亮”（你截图红框属于 TextMate scopes），导致扩展无法配置该类颜色。

## 验证方式
1) 编译：`npm run compile`
2) 手工验证：打开 `Token Styler: Open` → 勾选“使用自定义 selector” → 选择 TextMate → 粘贴 scope（如 `entity.name.function.definition.cpp`）→ 改颜色 → 观察预览变化；不保存关闭面板应自动回滚。

---

2026-01-31 08:34:12

## 变更摘要
- 调整 UI 层级：移除“配置面板内的高级自定义 selector”，改为与 Token Type 同级：在 Token 列表顶部下拉中新增 `TextMate Scopes` 选项（同一个下拉同时包含“语义：语言扩展/语义：标准（LSP）”）。
- 体验优化：TextMate Scopes 模式下隐藏语义开关区与修饰符区，避免用户混淆；支持在搜索框粘贴 scope 并按回车选中。
- 文档同步：README 更新为新的入口描述。

## 变更原因
- 用户反馈：TextMate scopes 配置不应嵌在 token 配置内部，应与 Token Type 同级（或与语言同级）以减少混淆。

## 验证方式
1) 编译：`npm run compile`
2) 手工验证：打开 `Token Styler: Open` → Token 下拉选择 `TextMate Scopes` → 在搜索框粘贴 `entity.name.function.definition.cpp` 并回车 → 设置颜色/样式 → 观察预览变化。

---

2026-01-31 09:16:00

## 变更摘要
- 增加 Marketplace 发布准备：新增 `.vscodeignore`、补齐 `package.json` 的仓库信息与 `package/publish` 脚本，并安装 `@vscode/vsce` 以便打包/发布。
- 新增发布参考文档：`docs/reference/VSCode Marketplace 发布流程.md`，用于跨机器同步发布步骤。

## 变更原因
- 用户要求把扩展上架 VS Code Marketplace，并且需要“可复制的发布流程”同步到异地机器。

## 验证方式
1) 编译：`npm run compile`
2) 打包：`npm run package`

补充：`npm run package` 当前会提示缺少 `LICENSE*` 文件（警告）；是否补充 License 需要仓库负责人确认授权后再做。

---

2026-01-31 11:29:03

## 变更摘要
- 整理 README：按“功能概览/使用方式/隔离说明/语言显示/开发运行”重排，避免用户混淆 semantic 与 TextMate 两套配置入口。
- 增加扩展本地化资源：引入 `package.nls.json` 与 `package.nls.zh-cn.json`，让扩展名/描述/命令标题随 VS Code UI 语言切换显示（中文优先，英文可切换）。

## 变更原因
- 用户要求整理 Readme，并保证 VS Code 扩展市场与命令面板显示文案可中英文切换。

## 验证方式
1) 编译：`npm run compile`
2) 打包：`npm run package`（确认 vsix 中包含 `package.nls*.json`）

---

2026-01-31 11:37:38

## 变更摘要
- 增加英文版 README：新增 `README.en.md`，并在 `README.md` 顶部增加互链入口。
- 增加 GitHub Actions CI/CD：新增 `.github/workflows/ci.yml`（编译+打包）与 `.github/workflows/publish.yml`（tag/手动发布 Marketplace）。
- 修正打包忽略：`.vscodeignore` 排除 `.github/`，避免把工作流文件打进 vsix；发布命令增加 `--githubBranch main` 以便推断 README 相对链接。

## 变更原因
- 用户要求 README 提供英文版本，并希望在 GitHub 上实现自动化 CI/CD 发布到 Visual Studio Marketplace。

## 验证方式
1) 编译：`npm run compile`
2) 打包：`npm run package`（确认 vsix 不包含 `.github/`）

---

2026-01-31 11:48:51

## 变更摘要
- 确认并记录 Marketplace Publisher ID：`package.json.publisher` 当前为 `liekong1991`，并同步修正发布流程文档中“publisher=local”的旧描述。

## 变更原因
- 用户提供 Publisher ID（liekong1991），需要同步到跨机器发布文档以避免遗漏。

---

2026-01-31 12:49:37

## 变更摘要
- 移除冗余激活事件：删除 `package.json.activationEvents` 中仅用于 `onCommand:*` 的条目，改由 VS Code 从 `contributes.commands` 自动生成，消除 VS Code 的 warning 提示。

## 变更原因
- VS Code 提示该类激活事件可由贡献声明自动推导，保留会产生冗余 warning，影响维护体验。

## 验证方式
1) 编译：`npm run compile`

---

2026-01-31 12:56:04

## 变更摘要
- 新增“每次提交自动发版”的 GitHub Actions：
  - push main 自动 `npm version` 并打 tag：`.github/workflows/bump.yml`
  - tag `v*` 自动创建 GitHub Release、上传 vsix 并发布 Marketplace：`.github/workflows/publish.yml`
- 更新发布参考文档，记录版本 bump 规则与注意事项：`docs/reference/VSCode Marketplace 发布流程.md`

## 变更原因
- 用户希望每次提交自动增版本、自动生成 GitHub Release，并自动发布到 VS Code Marketplace。

## 验证方式（最小）
1) 确保 GitHub Secrets 已配置：`VSCE_PAT`
2) 推送一个 commit 到 main：
   - 期望：生成一个新的 tag（vX.Y.Z）
   - 期望：自动生成对应 GitHub Release，并触发 Marketplace 发布

---

2026-01-31 13:18:14

## 变更摘要
- 修复自动发布链路：`.github/workflows/publish.yml` 改为监听 `workflow_run(Bump version and tag)`，避免 “Actions 推出来的 tag 默认不触发其他工作流” 导致的发布不执行。
- 修复 GitHub Release 权限与产物上传：`contents: write` + 使用 `softprops/action-gh-release` 自动把 `*.vsix` 附加到 Release。
- 发布命令改为发布已打包的 VSIX：`vsce publish --packagePath *.vsix`，并加 `--skip-duplicate`、`--skip-license` 作为兜底。
- 发布工作流增加手动参数：可在 Actions 手动指定 `tag`（例如 `v0.0.2`）进行补发。

## 变更原因
- 用户反馈：tag 已存在（如 `v0.0.2`），但 Release 页面没有 vsix 产物且 Marketplace 未更新版本；需要修复工作流触发链路与 Release/发布权限。

## 验证方式
1) 本地打包验证：`npm ci && npm run compile && npm run package`（生成 `*.vsix`）
2) 推送一个新 commit 到 `main`：
   - 期望：先运行 `Bump version and tag` 生成新 tag（如 `v0.0.3`）
   - 期望：随后运行 `Publish to VS Code Marketplace`，在 Release 中看到 `*.vsix` 且 Marketplace 版本更新

---

2026-01-31 13:36:28

## 变更摘要
- 完善面向用户的 README（中英文）：补充“适用场景/分步用法/保存与回滚/语义 vs TextMate 选择建议”等，减少用户混淆：`README.md`、`README.en.md`。
- 清理临时文件：删除根目录的 `.tmp-vsce-show.json`（仅用于本地调试 `vsce show` 输出，不应提交），并加入忽略规则：`.gitignore`。

## 变更原因
- 用户要求 README 主要面向使用者，需把使用方式写清楚；同时临时文件不应进入版本库。

## 验证方式
1) 本地编译：`npm run compile`
2) 本地打包：`npm run package`（确认 vsix 内包含更新后的 README）
